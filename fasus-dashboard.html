<!DOCTYPE html>
<html lang="id">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fasus Budget Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
margin:0;
font-family:Arial,sans-serif;
background:#f4f6f9;
}

.header{
background:#1a1a1a;
color:white;
padding:15px 30px;
display:flex;
justify-content:space-between;
align-items:center;
}

.logo{
height:35px;
}

.container{
padding:30px;
}

.company{
font-size:28px;
font-weight:bold;
margin-bottom:5px;
}

.updated{
color:#666;
margin-bottom:25px;
}

.summary{
display:flex;
gap:20px;
margin-bottom:30px;
}

.card{
background:white;
padding:20px;
border-radius:8px;
flex:1;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.card-title{
color:#666;
margin-bottom:10px;
}

.card-value{
font-size:26px;
font-weight:bold;
}

.charts{
display:flex;
gap:30px;
margin-bottom:30px;
}

.chart-box{
background:white;
padding:20px;
border-radius:8px;
flex:1;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

table{
width:100%;
border-collapse:collapse;
background:white;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

th,td{
padding:12px;
border-bottom:1px solid #ddd;
}

th{
background:#f8f8f8;
}

.done{
color:green;
font-weight:bold;
}

.notyet{
color:red;
font-weight:bold;
}

</style>

</head>
<body>

<div class="header">

<img src="logo-ut.png" class="logo">

<div>Fasus Budget Dashboard</div>

</div>

<div class="container">

<div id="companyName" class="company"></div>

<div id="lastUpdated" class="updated"></div>

<div class="summary">

<div class="card">
<div class="card-title">Total Amount PJB</div>
<div id="totalPJB" class="card-value">Rp 0</div>
</div>

<div class="card">
<div class="card-title">Total Amount Terpakai</div>
<div id="totalUsed" class="card-value">Rp 0</div>
</div>

<div class="card">
<div class="card-title">Total Amount Sisa Budget PJB</div>
<div id="totalRemaining" class="card-value">Rp 0</div>
</div>

</div>

<div class="charts">

<div class="chart-box">
<canvas id="pieChart"></canvas>
</div>

<div class="chart-box">
<canvas id="barChart"></canvas>
</div>

</div>

<table>

<thead>
<tr>
<th>PJB</th>
<th>Serial Number</th>
<th>Expired Date</th>
<th>Sisa Budget</th>
<th>Status</th>
</tr>
</thead>

<tbody id="tableBody"></tbody>

</table>

</div>

<script>

const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTbJYRkPPTPDYHrDTy-eA_e5rUZ_VowdvBDjHU0BD7rKTvHIZfZAQf_ctl8qDkpiGYVnr9qARdX4fZ6/pub?gid=1924167205&single=true&output=csv";

const params=new URLSearchParams(window.location.search);

const company=params.get("company");

document.getElementById("companyName").textContent=company;

document.getElementById("lastUpdated").textContent=
"Last updated: "+new Date().toLocaleString("id-ID");


/* PARSER AMAN UNTUK FORMAT RP, NUMBER, ATAU TEXT */
function parseRupiah(value){

if(!value) return 0;

return Number(
value
.toString()
.replace(/[^0-9]/g,"")
)||0;

}

function formatRupiah(number){

return new Intl.NumberFormat("id-ID",{
style:"currency",
currency:"IDR",
minimumFractionDigits:0
}).format(number);

}


/* CSV PARSER */
function parseCSV(text){

const rows=text.trim().split("\n");

const data=[];

for(let i=1;i<rows.length;i++){

const cols=rows[i].split(",");

if(cols.length<8) continue;

data.push({

company:cols[0].trim(),

expired:cols[1].trim(),

amountPJB:parseRupiah(cols[2]),

status:cols[3].trim(),

pjb:cols[4].trim(),

serial:cols[5].trim(),

used:parseRupiah(cols[6]),

remaining:parseRupiah(cols[7])

});

}

return data;

}


fetch(CSV_URL)
.then(res=>res.text())
.then(text=>{

const all=parseCSV(text);

const filtered=all.filter(row=>row.company===company);

let totalPJB=0;
let totalUsed=0;
let totalRemaining=0;

let doneCount=0;
let notYetCount=0;

const tbody=document.getElementById("tableBody");

filtered.forEach(row=>{

totalPJB+=row.amountPJB;
totalUsed+=row.used;
totalRemaining+=row.remaining;

if(row.status==="DONE") doneCount++;
else notYetCount++;

tbody.innerHTML+=`

<tr>
<td>${row.pjb}</td>
<td>${row.serial}</td>
<td>${row.expired}</td>
<td>${formatRupiah(row.remaining)}</td>
<td class="${row.status==="DONE"?"done":"notyet"}">${row.status}</td>
</tr>

`;

});


document.getElementById("totalPJB").textContent=
formatRupiah(totalPJB);

document.getElementById("totalUsed").textContent=
formatRupiah(totalUsed);

document.getElementById("totalRemaining").textContent=
formatRupiah(totalRemaining);


new Chart(document.getElementById("pieChart"),{

type:"pie",

data:{
labels:["Terpakai","Tersisa"],
datasets:[{
data:[totalUsed,totalRemaining],
backgroundColor:["#ff6384","#36a2eb"]
}]
}

});


new Chart(document.getElementById("barChart"),{

type:"bar",

data:{
labels:["DONE","NOT YET"],
datasets:[{
label:"Jumlah",
data:[doneCount,notYetCount],
backgroundColor:["green","red"]
}]
}

});

});

</script>

</body>
</html>
