<!DOCTYPE html>
<html lang="id">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fasus Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
margin:0;
font-family:Arial;
background:#f4f6f9;
}

.header{
background:#1a1a1a;
color:white;
padding:15px 30px;
display:flex;
justify-content:space-between;
align-items:center;
}

.logo{
height:35px;
}

.container{
padding:30px;
}

.company{
font-size:26px;
font-weight:bold;
margin-bottom:5px;
}

.updated{
color:#666;
margin-bottom:25px;
}

.summary{
display:flex;
gap:20px;
margin-bottom:30px;
}

.card{
background:white;
padding:20px;
border-radius:8px;
flex:1;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.card-title{
color:#666;
margin-bottom:10px;
}

.card-value{
font-size:24px;
font-weight:bold;
}

.charts{
display:flex;
gap:30px;
margin-bottom:30px;
}

.chart-box{
background:white;
padding:20px;
border-radius:8px;
flex:1;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

table{
width:100%;
border-collapse:collapse;
background:white;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

th,td{
padding:12px;
border-bottom:1px solid #ddd;
}

th{
background:#f8f8f8;
}

.done{
color:green;
font-weight:bold;
}

.notyet{
color:red;
font-weight:bold;
}

</style>

</head>
<body>

<div class="header">

<img src="logo-ut.png" class="logo">

<div>Fasus Budget Dashboard</div>

</div>

<div class="container">

<div id="companyName" class="company"></div>

<div id="lastUpdated" class="updated"></div>

<div class="summary">

<div class="card">
<div class="card-title">Total Budget</div>
<div id="totalBudget" class="card-value">0</div>
</div>

<div class="card">
<div class="card-title">Total Terpakai</div>
<div id="totalUsed" class="card-value">0</div>
</div>

<div class="card">
<div class="card-title">Total Tersisa</div>
<div id="totalRemaining" class="card-value">0</div>
</div>

</div>

<div class="charts">

<div class="chart-box">
<canvas id="pieChart"></canvas>
</div>

<div class="chart-box">
<canvas id="barChart"></canvas>
</div>

</div>

<table>

<thead>
<tr>
<th>PJB</th>
<th>Serial Number</th>
<th>Expired Date</th>
<th>Sisa Budget</th>
<th>Status</th>
</tr>
</thead>

<tbody id="tableBody"></tbody>

</table>

</div>

<script>

const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTbJYRkPPTPDYHrDTy-eA_e5rUZ_VowdvBDjHU0BD7rKTvHIZfZAQf_ctl8qDkpiGYVnr9qARdX4fZ6/pub?gid=1924167205&single=true&output=csv";

const params=new URLSearchParams(window.location.search);

const company=params.get("company");

document.getElementById("companyName").textContent=company;

document.getElementById("lastUpdated").textContent=
"Last updated: "+new Date().toLocaleString();

function parseCSV(text){

const lines=text.split("\n");

const data=[];

for(let i=1;i<lines.length;i++){

const cols=lines[i].split(",");

if(cols.length<8) continue;

data.push({

company:cols[0].trim(),
expired:cols[1].trim(),
budget:parseFloat(cols[2])||0,
status:cols[3].trim(),
pjb:cols[4].trim(),
sn:cols[5].trim(),
used:parseFloat(cols[6])||0,
remaining:parseFloat(cols[7])||0

});

}

return data;

}

fetch(CSV_URL)
.then(res=>res.text())
.then(text=>{

const all=parseCSV(text);

const filtered=all.filter(x=>x.company===company);

let totalBudget=0;
let totalUsed=0;
let totalRemaining=0;

let doneCount=0;
let notYetCount=0;

const tbody=document.getElementById("tableBody");

filtered.forEach(item=>{

totalBudget+=item.budget;
totalUsed+=item.used;
totalRemaining+=item.remaining;

if(item.status==="DONE"){
doneCount++;
}else{
notYetCount++;
}

const row=document.createElement("tr");

row.innerHTML=`
<td>${item.pjb}</td>
<td>${item.sn}</td>
<td>${item.expired}</td>
<td>${item.remaining.toLocaleString()}</td>
<td class="${item.status==="DONE"?"done":"notyet"}">${item.status}</td>
`;

tbody.appendChild(row);

});

document.getElementById("totalBudget").textContent=
totalBudget.toLocaleString();

document.getElementById("totalUsed").textContent=
totalUsed.toLocaleString();

document.getElementById("totalRemaining").textContent=
totalRemaining.toLocaleString();

createCharts(totalUsed,totalRemaining,doneCount,notYetCount);

});

function createCharts(used,remaining,doneCount,notYetCount){

new Chart(document.getElementById("pieChart"),{

type:"pie",

data:{
labels:["Terpakai","Tersisa"],
datasets:[{
data:[used,remaining],
backgroundColor:["#ff6384","#36a2eb"]
}]
}

});

new Chart(document.getElementById("barChart"),{

type:"bar",

data:{
labels:["DONE","NOT YET"],
datasets:[{
data:[doneCount,notYetCount],
backgroundColor:["green","red"]
}]
}

});

}

</script>

</body>
</html>
