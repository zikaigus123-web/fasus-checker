<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Dashboard Fasus</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
margin:0;
font-family:Arial;
background:#0b0b0b;
color:white;
}

/* HEADER */

.header{
background:#FFD100;
color:black;
padding:18px;
font-size:24px;
font-weight:bold;
display:flex;
justify-content:space-between;
align-items:center;
position:relative;
}

.header-left{
z-index:1;
}

.header-center{
position:absolute;
left:50%;
transform:translateX(-50%);
}

.header-right{
z-index:1;
font-size:18px;
}

.logo-ut{
height:50px;
object-fit:contain;
}

/* BACK BUTTON */

.back{
margin:15px;
padding:10px 20px;
background:#FFD100;
border:none;
cursor:pointer;
font-weight:bold;
}

/* CONTENT */

.container{
padding:20px;
}

.card{
background:#1a1a1a;
padding:20px;
border-radius:10px;
margin-bottom:20px;
}

.grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
}

table{
width:100%;
border-collapse:collapse;
}

th{
background:#FFD100;
color:black;
padding:10px;
}

td{
padding:10px;
border-bottom:1px solid #333;
}

/* SPINNER */

.spinner{
position:fixed;
width:100%;
height:100%;
background:rgba(0,0,0,0.7);
display:flex;
justify-content:center;
align-items:center;
z-index:10;
}

.loader{
border:8px solid #333;
border-top:8px solid #FFD100;
border-radius:50%;
width:70px;
height:70px;
animation:spin 1s linear infinite;
}

@keyframes spin{
0%{transform:rotate(0deg);}
100%{transform:rotate(360deg);}
}

</style>
</head>

<body>

<!-- SPINNER -->

<div id="spinner" class="spinner">
<div class="loader"></div>
</div>

<!-- HEADER -->

<div class="header">

<div class="header-left" id="title">
Dashboard
</div>

<div class="header-center">
<img src="ut-school-logo.png" class="logo-ut">
</div>

<div class="header-right" id="lastUpdated">
Last updated:
</div>

</div>

<!-- BACK BUTTON -->

<button class="back"
onclick="window.location.href='index.html'">
‚Üê Back
</button>

<!-- CONTENT -->

<div class="container" id="content" style="display:none;">

<div class="grid">

<div class="card">

<h3>Financial Summary</h3>

<p>Total Budget:
<span id="total"></span></p>

<p>Terpakai:
<span id="used"></span></p>

<p>Tersisa:
<span id="remaining"></span></p>

</div>

<div class="card">
<canvas id="pie"></canvas>
</div>

</div>

<div class="card">
<canvas id="bar"></canvas>
</div>

<div class="card">

<h3>Detail List</h3>

<table>

<thead>
<tr>
<th>PJB</th>
<th>Serial</th>
<th>Expired</th>
<th>Sisa</th>
<th>Status</th>
</tr>
</thead>

<tbody id="table"></tbody>

</table>

</div>

</div>

<script>

/* FORMAT RUPIAH */

function formatRupiah(num){
return "Rp " + Number(num).toLocaleString("id-ID");
}

/* GET PARAM */

const params =
new URLSearchParams(window.location.search);

const fasus =
params.get("fasus");

document.getElementById("title").innerText =
fasus + " Dashboard";

/* FETCH DATA */

fetch(
"https://dummyacountsubhan1.app.n8n.cloud/webhook/check-budget",
{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({fasus})
}
)
.then(res=>res.json())
.then(data=>{

/* HIDE SPINNER */

document.getElementById("spinner").style.display="none";
document.getElementById("content").style.display="block";

/* LAST UPDATED */

document.getElementById("lastUpdated").innerText =
"Last updated: " +
new Date(data.last_updated).toLocaleString();

/* SUMMARY */

document.getElementById("total").innerText =
formatRupiah(data.summary.total_budget);

document.getElementById("used").innerText =
formatRupiah(data.summary.total_used);

document.getElementById("remaining").innerText =
formatRupiah(data.summary.total_remaining);

/* PIE CHART */

new Chart(document.getElementById("pie"),{

type:"pie",

data:{
labels:["Terpakai","Tersisa"],
datasets:[{
data:[
data.summary.total_used,
data.summary.total_remaining
],
backgroundColor:[
"#ff3b3b",
"#00c853"
]
}]
}

});

/* TABLE + BAR DATA */

let done=0;
let notyet=0;

data.details.forEach(d=>{

if(d.status==="DONE")
done++;
else
notyet++;

document.getElementById("table").innerHTML+=
`<tr>
<td>${d.pjb}</td>
<td>${d.serial}</td>
<td>${d.expired}</td>
<td>${formatRupiah(d.sisa)}</td>
<td>${d.status}</td>
</tr>`;

});

/* BAR CHART */

new Chart(document.getElementById("bar"),{

type:"bar",

data:{
labels:["DONE","NOT YET"],
datasets:[{
label:"Jumlah Status",
data:[done,notyet],
backgroundColor:[
"#00c853",
"#FFD100"
]
}]
},

options:{
plugins:{
legend:{display:false}
}
}

});

})

.catch(err=>{
console.log(err);
alert("Gagal mengambil data dari server");
});

</script>

</body>
</html>
