<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Fasus</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
margin:0;
font-family:Arial;
background:#0b0b0b;
color:white;
}

.header{
background:#FFD100;
color:black;
padding:20px;
font-size:24px;
font-weight:bold;
}

.back{
margin:20px;
padding:10px 20px;
background:#FFD100;
border:none;
cursor:pointer;
font-weight:bold;
}

.container{
padding:20px;
}

.card{
background:#1a1a1a;
padding:20px;
border-radius:8px;
margin-bottom:20px;
}

.grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
}

table{
width:100%;
border-collapse:collapse;
}

th{
background:#FFD100;
color:black;
padding:10px;
}

td{
padding:10px;
border-bottom:1px solid #333;
}

.spinner{
text-align:center;
margin-top:50px;
font-size:20px;
}

</style>
</head>

<body>

<div class="header" id="title">Dashboard</div>

<button class="back"
onclick="window.location.href='index.html'">
‚Üê Back
</button>

<div class="container">

<div id="loading" class="spinner">
Loading dashboard...
</div>

<div id="content" style="display:none;">

<div class="grid">

<div class="card">

<h3>Financial Summary</h3>

<p>Total Budget: Rp<span id="total"></span></p>

<p>Terpakai: Rp<span id="used"></span></p>

<p>Tersisa: Rp<span id="remaining"></span></p>

</div>

<div class="card">

<canvas id="pie"></canvas>

</div>

</div>

<div class="card">

<canvas id="bar"></canvas>

</div>

<div class="card">

<h3>Detail List</h3>

<table>

<thead>
<tr>
<th>PJB</th>
<th>Serial</th>
<th>Expired</th>
<th>Sisa</th>
<th>Status</th>
</tr>
</thead>

<tbody id="table"></tbody>

</table>

</div>

</div>

</div>

<script>

const urlParams =
new URLSearchParams(window.location.search);

const fasus =
urlParams.get("fasus");

document.getElementById("title").innerText =
fasus + " Dashboard";

fetch(
"https://dummyacountsubhan1.app.n8n.cloud/webhook/check-budget",
{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
fasus:fasus
})
}
)
.then(res=>res.json())
.then(data=>{

document.getElementById("loading").style.display="none";

document.getElementById("content").style.display="block";

document.getElementById("total").innerText =
data.summary.total_budget.toLocaleString();

document.getElementById("used").innerText =
data.summary.total_used.toLocaleString();

document.getElementById("remaining").innerText =
data.summary.total_remaining.toLocaleString();

new Chart(document.getElementById("pie"),{
type:"pie",
data:{
labels:["Used","Remaining"],
datasets:[{
data:[
data.summary.total_used,
data.summary.total_remaining
]
}]
}
});

let done=0;
let notyet=0;

data.details.forEach(d=>{
if(d.status==="DONE") done++;
else notyet++;
});

new Chart(document.getElementById("bar"),{
type:"bar",
data:{
labels:["DONE","NOT YET"],
datasets:[{
data:[done,notyet]
}]
}
});

const table =
document.getElementById("table");

data.details.forEach(d=>{

table.innerHTML+=
"<tr>"+
"<td>"+d.pjb+"</td>"+
"<td>"+d.serial+"</td>"+
"<td>"+d.expired+"</td>"+
"<td>"+d.sisa+"</td>"+
"<td>"+d.status+"</td>"+
"</tr>";

});

});

</script>

</body>
</html>
